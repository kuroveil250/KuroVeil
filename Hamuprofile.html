<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hamu Dango ‚Ä¢ Kuroveil</title>
  <meta name="description" content="Hamu Dango ‚Äî a rat-hamster jester from Dangoland, bringing sweet chaos to livestreaming." />
  <meta name="theme-color" content="#f3b37a" />
  <meta name="color-scheme" content="dark" />

  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      /* ===== Default Theme: Sunset Warm ===== */
      --bg0:#120a09;
      --bg1:#2a1410;

      --glow1:#ffb36b; /* peach */
      --glow2:#ffd08b; /* cream */
      --glow3:#ff8ab4; /* soft pink */
      --glow4:#7fe7ff; /* aqua accent */

      --text:#fff7ef;
      --muted: rgba(255,247,239,.78);

      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.11);
      --line: rgba(255,255,255,.18);

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 14px 40px rgba(0,0,0,.45);

      --radius: 22px;

      --max: 1160px;
      --pad: clamp(16px, 3vw, 28px);

      --slash: rgba(255,255,255,.92);
      --slash2: rgba(255,255,255,.35);

      --ring: rgba(255, 190, 132, .38);
      --ring2: rgba(255, 138, 180, .25);

      --ease: cubic-bezier(.2,.8,.2,1);

      /* Chaos meter (0..100) */
      --chaos: 35;
      --sparkleIntensity: .85; /* updated via JS */
      --wiggle: 0deg;          /* updated via JS */

      /* Live badge */
      --liveOn: 0; /* 0/1 */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1100px 700px at 18% 16%, color-mix(in oklab, var(--glow1) 22%, transparent), transparent 58%),
        radial-gradient(900px 640px at 74% 18%, color-mix(in oklab, var(--glow2) 20%, transparent), transparent 56%),
        radial-gradient(980px 780px at 60% 78%, color-mix(in oklab, var(--glow3) 14%, transparent), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* ===== Background layers ===== */
    .bg{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-6;
    }
    .bg::before{
      content:"";
      position:absolute; inset:-20%;
      background:
        radial-gradient(closest-side at 20% 25%, color-mix(in oklab, var(--glow1) 24%, transparent), transparent 60%),
        radial-gradient(closest-side at 70% 30%, color-mix(in oklab, var(--glow2) 18%, transparent), transparent 62%),
        radial-gradient(closest-side at 60% 78%, color-mix(in oklab, var(--glow3) 12%, transparent), transparent 66%),
        radial-gradient(closest-side at 30% 85%, color-mix(in oklab, var(--glow4) 10%, transparent), transparent 65%);
      filter: blur(26px);
      opacity:.95;
      transform: translateZ(0);
    }
    .bg::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 12% 18%, rgba(255,255,255,.08) 0 2px, transparent 3px),
        radial-gradient(circle at 18% 34%, rgba(255,255,255,.06) 0 1.5px, transparent 3px),
        radial-gradient(circle at 28% 22%, rgba(255,255,255,.07) 0 2px, transparent 3px),
        radial-gradient(circle at 55% 14%, rgba(255,255,255,.06) 0 2px, transparent 3px),
        radial-gradient(circle at 62% 30%, rgba(255,255,255,.06) 0 1.5px, transparent 3px),
        radial-gradient(circle at 75% 18%, rgba(255,255,255,.08) 0 2px, transparent 3px),
        radial-gradient(circle at 82% 36%, rgba(255,255,255,.06) 0 1.6px, transparent 3px),
        radial-gradient(circle at 70% 72%, rgba(255,255,255,.06) 0 1.8px, transparent 3px),
        radial-gradient(circle at 35% 66%, rgba(255,255,255,.06) 0 1.7px, transparent 3px),
        radial-gradient(circle at 22% 78%, rgba(255,255,255,.05) 0 1.4px, transparent 3px);
      opacity:.85;
      mix-blend-mode: screen;
      filter: blur(.2px);
    }

    /* Sparkles */
    .sparkles{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-5;
      opacity: var(--sparkleIntensity);
    }
    .sparkles i{
      position:absolute;
      width:6px; height:6px;
      border-radius:50%;
      background: radial-gradient(circle, rgba(255,255,255,.95), rgba(255,255,255,.25) 55%, transparent 70%);
      filter: blur(.2px);
      animation: floaty 10s var(--ease) infinite;
      opacity:.65;
    }
    @keyframes floaty{
      0%{ transform: translateY(0) translateX(0) scale(.9); opacity:.45; }
      50%{ transform: translateY(-22px) translateX(10px) scale(1.05); opacity:.85; }
      100%{ transform: translateY(0) translateX(0) scale(.95); opacity:.55; }
    }

    /* Mouse follower */
    .cursor{
      position:fixed;
      left:0; top:0;
      width: 22px; height: 22px;
      border-radius: 999px;
      pointer-events:none;
      z-index: 9999;
      transform: translate(-50%,-50%);
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.9),
        color-mix(in oklab, var(--glow1) 38%, transparent) 55%,
        color-mix(in oklab, var(--glow3) 22%, transparent));
      filter: blur(.2px);
      opacity: .85;
      transition: opacity .2s var(--ease);
    }
    .cursor::after{
      content:"";
      position:absolute; inset:-18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: radial-gradient(circle, color-mix(in oklab, var(--glow1) 16%, transparent), transparent 60%);
      opacity:.8;
      transform: scale(.9);
    }
    .cursor.hide{ opacity:0; }

    .wrap{
      width:min(var(--max), 100%);
      margin:0 auto;
      padding: var(--pad);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 14px 0 6px;
      flex-wrap: wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 0;
      flex: 1 1 240px;
    }
    .brand .dot{
      width:12px;height:12px;border-radius:99px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95),
        color-mix(in oklab, var(--glow1) 40%, transparent) 55%,
        color-mix(in oklab, var(--glow3) 30%, transparent));
      box-shadow: 0 0 18px color-mix(in oklab, var(--glow1) 25%, transparent);
    }
    .brand .title{
      font-weight:900;
      letter-spacing:.5px;
      font-size: 14px;
      text-transform: uppercase;
      opacity:.95;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .sub{
      font-size: 12px;
      color: var(--muted);
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .stack{ min-width:0; }

    .nav{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
      flex: 1 1 520px;
    }
    @media (max-width: 920px){
      .nav{ justify-content:flex-start; }
    }

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;
      border-radius: 14px;
      font-weight:700;
      font-size: 12px;
      letter-spacing:.2px;
      cursor:pointer;
      transition: transform .25s var(--ease), border-color .25s var(--ease), background .25s var(--ease);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .btn:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.09);
      border-color: rgba(255,255,255,.22);
    }

    /* Door badge (#017) */
    .door{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px 10px 10px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      cursor:pointer;
      user-select:none;
      transition: transform .25s var(--ease), border-color .25s var(--ease), background .25s var(--ease);
    }
    .door:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.26);
      background: rgba(255,255,255,.08);
    }
    .door .frame{
      width: 22px; height: 22px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, color-mix(in oklab, var(--glow1) 20%, transparent), rgba(255,255,255,.05));
      position:relative;
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
    }
    .door .frame::after{
      content:"";
      position:absolute;
      right:5px; top:50%;
      width:4px; height:4px;
      border-radius:999px;
      background: rgba(255,255,255,.75);
      transform: translateY(-50%);
      opacity:.85;
    }
    .door .code{
      font-weight:900;
      letter-spacing:.7px;
      font-size: 12px;
      opacity:.95;
      white-space:nowrap;
    }

    /* ‚úÖ FIX: SFX pill (no weird white rectangles + proper range styling) */
    .audioPill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 9px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      user-select:none;
      box-shadow: 0 12px 30px rgba(0,0,0,.28);
      max-width: 100%;
      min-width: 0;
      overflow: hidden;
      padding-right: 14px;
    }
    .audioPill b{
      font-size:11px;
      letter-spacing:.5px;
      text-transform:uppercase;
      opacity:.9;
      margin-right:2px;
    }

    .toggle{
      width: 44px; height: 24px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      position:relative;
      cursor:pointer;
      transition: .22s var(--ease);
      flex: 0 0 auto;
      outline:none;
    }
    .toggle::after{
      content:"";
      position:absolute;
      width:18px; height:18px;
      border-radius: 999px;
      left:3px; top:50%;
      transform: translateY(-50%);
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,179,107,.45));
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
      transition: .22s var(--ease);
    }
    .toggle.on{
      background: rgba(255,179,107,.18);
      border-color: rgba(255,255,255,.22);
    }
    .toggle.on::after{ left: 22px; }

    /* Custom range to eliminate the ‚Äúwhite blocks/rectangles‚Äù look */
    .vol{
      flex: 1 1 110px;
      width: clamp(90px, 12vw, 130px);
      min-width: 0;
      max-width: 100%;
      background: transparent;
      -webkit-appearance: none;
      appearance: none;
      height: 24px;
      padding: 0;
      margin: 0;
      outline: none;
    }
    /* Track */
    .vol::-webkit-slider-runnable-track{
      height: 8px;
      border-radius: 999px;
      background:
        linear-gradient(90deg,
          color-mix(in oklab, var(--glow1) 70%, rgba(255,255,255,.18)),
          color-mix(in oklab, var(--glow3) 55%, rgba(255,255,255,.12))
        );
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.12);
    }
    .vol::-webkit-slider-thumb{
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      margin-top: -4.5px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,208,139,.65));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 10px 20px rgba(0,0,0,.35), 0 0 18px rgba(255,179,107,.18);
      cursor: pointer;
    }
    .vol:focus-visible::-webkit-slider-thumb{
      box-shadow: 0 10px 20px rgba(0,0,0,.35), 0 0 0 6px rgba(255,179,107,.12), 0 0 18px rgba(255,179,107,.25);
    }
    /* Firefox */
    .vol::-moz-range-track{
      height: 8px;
      border-radius: 999px;
      background:
        linear-gradient(90deg,
          color-mix(in oklab, var(--glow1) 70%, rgba(255,255,255,.18)),
          color-mix(in oklab, var(--glow3) 55%, rgba(255,255,255,.12))
        );
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.12);
    }
    .vol::-moz-range-thumb{
      width: 16px; height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,208,139,.65));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 10px 20px rgba(0,0,0,.35), 0 0 18px rgba(255,179,107,.18);
      cursor:pointer;
    }
    .vol::-moz-range-progress{
      height: 8px;
      border-radius: 999px;
      background: color-mix(in oklab, var(--glow1) 75%, rgba(255,255,255,.10));
    }

    /* ‚úÖ REMOVE SFX SLIDER VISUALLY (keep element + JS safe) */
    .audioPill{ gap: 8px; }
    .vol{ display:none !important; width:0 !important; }

    /* Live badge */
    .liveBadge{
      position:fixed;
      right: clamp(14px, 2vw, 22px);
      top: clamp(14px, 2vw, 22px);
      z-index: 9998;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      cursor:pointer;
      user-select:none;
      transition: transform .25s var(--ease), border-color .25s var(--ease), background .25s var(--ease);
    }
    .liveBadge:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.24); }
    .liveDot{
      width:10px;height:10px;border-radius:99px;
      background: rgba(255,255,255,.22);
      box-shadow:none;
      transition: background .25s var(--ease), box-shadow .25s var(--ease);
    }
    body[data-live="1"] .liveDot{
      background: #ff4d6d;
      box-shadow: 0 0 0 6px rgba(255,77,109,.18), 0 0 18px rgba(255,77,109,.35);
      animation: pulse 1.2s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.12); }
    }
    .liveText{ font-weight:900; font-size:12px; letter-spacing:.3px; }
    .liveSub{ font-size:11px; color: rgba(255,247,239,.72); margin-top:1px; }
    .liveStack{ display:flex; flex-direction:column; line-height:1.1; }

    /* Hero */
    .hero{
      margin-top: 14px;
      display:grid;
      grid-template-columns: minmax(0, 1.15fr) minmax(0, .85fr);
      gap: clamp(14px, 2.6vw, 22px);
      align-items: stretch;
    }
    .hero > *{ min-width: 0; }
    @media (max-width: 920px){
      .hero{ grid-template-columns: 1fr; }
      .liveBadge{ left: 14px; right:auto; }
    }

    .panel{
      position:relative;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow2);
      overflow:hidden;
      min-width:0;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:auto auto -55% -20%;
      width: 200%;
      height: 140%;
      background: linear-gradient(90deg, transparent, var(--slash2), transparent);
      transform: rotate(-18deg);
      opacity:.35;
      pointer-events:none;
    }
    .panel .inner{
      padding: clamp(16px, 3vw, 26px);
      position:relative;
      z-index:1;
    }

/* ‚úÖ Make HERO panels pop like cards */
.panel{
  transition: transform .28s var(--ease), border-color .28s var(--ease),
              background .28s var(--ease), box-shadow .28s var(--ease);
  will-change: transform;
}

/* add a ring layer like .card has */
.panel::after{
  content:"";
  position:absolute; inset:-1px;
  border-radius: inherit;
  background:
    radial-gradient(900px 300px at 20% 10%, var(--ring), transparent 65%),
    radial-gradient(900px 300px at 80% 20%, var(--ring2), transparent 70%);
  opacity:0;
  transition: opacity .28s var(--ease);
  pointer-events:none;
}

/* strengthen slash on hover (your panel already has ::before) */
.panel::before{
  transition: opacity .28s var(--ease), transform .28s var(--ease);
  opacity:.22; /* was .35; calmer idle */
  transform: rotate(-18deg) translateY(18px);
}

.panel:hover{
  transform: translateY(-10px) scale(1.01);
  border-color: rgba(255,255,255,.22);
  background: linear-gradient(180deg, rgba(255,255,255,.11), rgba(255,255,255,.07));
  box-shadow: 0 24px 70px rgba(0,0,0,.58);
}

.panel:hover::before{
  opacity:.85;
  transform: rotate(-18deg) translateY(0);
}

.panel:hover::after{
  opacity:1;
}

/* Keep the right art panel behaving the same */
.panel.art:hover{
  transform: translateY(-10px) scale(1.01);
}
    .heroTitle{
      font-size: clamp(30px, 4.2vw, 46px);
      line-height:1.05;
      margin:0;
      letter-spacing:.2px;
    }
    .heroK{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      color: var(--muted);
      font-weight:600;
      font-size: 14px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size: 12px;
      color: rgba(255,247,239,.9);
    }
    .pill b{ font-weight:900; letter-spacing:.2px; }

    .lore{
      margin-top: 14px;
      color: rgba(255,247,239,.88);
      font-size: 14px;
      line-height:1.7;
    }
    .lore strong{ color: rgba(255,247,239,.97); }

    .ctaRow{
      margin-top: 18px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
    .cta{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 12px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, color-mix(in oklab, var(--glow1) 22%, transparent), rgba(255,255,255,.06));
      cursor:pointer;
      text-decoration:none;
      color: var(--text);
      font-weight:900;
      transition: transform .25s var(--ease), filter .25s var(--ease), border-color .25s var(--ease);
    }
    .cta:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.22);
      filter: brightness(1.06);
    }
    .cta.secondary{
      background: rgba(255,255,255,.07);
      font-weight:800;
    }

    /* ‚úÖ Art panel */
    .art{
      position:relative;
      min-height: 420px;
      display:flex;
      align-items:stretch;
      justify-content:stretch;
      padding: 0;
    }
    .art::after{
      content:"";
      position:absolute;
      inset:auto 12% 8% 12%;
      height: 40%;
      background: radial-gradient(closest-side, color-mix(in oklab, var(--glow1) 25%, transparent), transparent 70%);
      filter: blur(18px);
      opacity:.9;
      z-index:0;
      pointer-events:none;
    }

    .stage{
      position:relative;
      z-index:1;
      width:100%;
      height:100%;
      border-radius: inherit;
      overflow:hidden;
      display:grid;
      grid-template-rows: auto 1fr auto;
      padding: 18px;
      gap: 12px;
      min-width:0;
    }

    .stageTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .stageBadge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }
    .stageBadge .spark{
      width:10px; height:10px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,179,107,.65));
      box-shadow: 0 0 18px rgba(255,179,107,.22);
    }
    .stageBadge .txt{
      display:flex; flex-direction:column; line-height:1.1;
    }
    .stageBadge .txt b{ font-size:12px; letter-spacing:.3px; }
    .stageBadge .txt span{ font-size:11px; color: rgba(255,247,239,.75); }

    .stageHint{
      font-size: 11px;
      color: rgba(255,247,239,.72);
      border:1px dashed rgba(255,255,255,.20);
      background: rgba(0,0,0,.12);
      padding: 8px 10px;
      border-radius: 14px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .stageMain{
      position:relative;
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(900px 320px at 25% 15%, rgba(255,179,107,.18), transparent 62%),
        radial-gradient(900px 320px at 82% 35%, rgba(255,138,180,.14), transparent 65%),
        radial-gradient(900px 320px at 55% 85%, rgba(127,231,255,.10), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.07), rgba(0,0,0,.10));
      overflow:hidden;
      display:grid;
      place-items:end center;
      padding: 10px 10px 0;
      box-shadow: 0 18px 55px rgba(0,0,0,.45);
      min-width:0;
    }
    .stageMain::before{
      content:"";
      position:absolute; inset:-40% -30%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
      transform: rotate(-18deg);
      opacity:.35;
      pointer-events:none;
    }

    .stageAI{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit: cover;
  opacity:.78;
  filter: saturate(1.08) contrast(1.02);
  transform: scale(1.08);   /* ‚úÖ was 1.02 */
  object-position: center;  /* you can change to "center top" if you want */
}

    .hamuMain{
      width:min(420px, 92%);
      height:auto;
      display:block;
      filter: drop-shadow(0 24px 55px rgba(0,0,0,.60));
      transform: translateY(8px);
      position:relative;
      z-index:2;
    }
    .hamuFloat{
      position:absolute;
      left: 14px;
      top: 16px;
      width: 120px;
      height:auto;
      opacity:.95;
      filter: drop-shadow(0 18px 35px rgba(0,0,0,.45));
      transform: translateY(22px); /* moved down a bit */
      z-index:3;
    }
    @media (max-width: 920px){
      .hamuFloat{ width: 96px; }
    }

    .stageBottom{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    .stagePills{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .miniPill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      font-weight:900;
      font-size: 11px;
      cursor:pointer;
      user-select:none;
      transition: transform .2s var(--ease), background .2s var(--ease), border-color .2s var(--ease);
    }
    .miniPill:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
    }

    .imgFallback{
      width:100%;
      height:100%;
      display:grid;
      place-items:center;
      text-align:center;
      padding: 20px;
      color: rgba(255,247,239,.82);
      position:absolute;
      inset:0;
      z-index:4;
      background: rgba(0,0,0,.16);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .imgFallback b{ color: rgba(255,247,239,.95); }
    .imgFallback .small{ font-size: 12px; color: rgba(255,247,239,.70); margin-top:6px; }

    /* Grid / Cards */
    .grid{
      margin-top: clamp(14px, 2.2vw, 18px);
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: clamp(12px, 2vw, 16px);
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: repeat(6, 1fr); }
    }
    @media (max-width: 560px){
      .grid{ grid-template-columns: repeat(1, 1fr); }
    }

    .card{
      grid-column: span 4;
      position:relative;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow2);
      overflow:hidden;
      transform: translateY(0) rotate(var(--wiggle));
      transition: transform .28s var(--ease), border-color .28s var(--ease), background .28s var(--ease), box-shadow .28s var(--ease);
    }
    .card::before{
      content:"";
      position:absolute;
      width: 160%;
      height: 160%;
      left:-35%;
      top:-75%;
      background: linear-gradient(90deg, transparent, var(--slash), transparent);
      opacity: 0;
      transform: rotate(-18deg) translateY(16px);
      transition: opacity .28s var(--ease), transform .28s var(--ease);
      pointer-events:none;
    }
    .card::after{
      content:"";
      position:absolute; inset:-1px;
      border-radius: inherit;
      background: radial-gradient(900px 300px at 20% 10%, var(--ring), transparent 65%),
                  radial-gradient(900px 300px at 80% 20%, var(--ring2), transparent 70%);
      opacity:0;
      transition: opacity .28s var(--ease);
      pointer-events:none;
    }
    .card:hover{
      transform: translateY(calc(-10px - (var(--chaos) * 0.03px))) scale(1.01) rotate(calc(var(--wiggle) * -1));
      border-color: rgba(255,255,255,.22);
      background: linear-gradient(180deg, rgba(255,255,255,.11), rgba(255,255,255,.07));
      box-shadow: 0 24px 70px rgba(0,0,0,.58);
    }
    .card:hover::before{ opacity: .85; transform: rotate(-18deg) translateY(0); }
    .card:hover::after{ opacity:1; }

    .card .in{
      position:relative;
      z-index:1;
      padding: 18px 18px 16px;
      min-height: 170px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .card h3{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .card p{
      margin:0;
      color: rgba(255,247,239,.82);
      font-size: 13px;
      line-height:1.55;
    }
/* ===== Individual Card Pop (open/close) ===== */
.card{
  cursor: pointer;
  outline: none;
}

.card.is-open{
  transform: translateY(calc(-14px - (var(--chaos) * 0.03px))) scale(1.015) rotate(calc(var(--wiggle) * -1));
  border-color: rgba(255,255,255,.26);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.075));
  box-shadow: 0 30px 85px rgba(0,0,0,.62);
  z-index: 20;
}

.card.is-open::before{ opacity: .92; transform: rotate(-18deg) translateY(0); }
.card.is-open::after{ opacity: 1; }

/* expand content smoothly */
.card .in{
  transition: max-height .35s var(--ease), padding .35s var(--ease);
}
.card.is-open .in{
  max-height: 520px; /* enough room for extra lines */
}

/* extra details area (hidden until open) */
.cardDetails{
  display:none;
  margin-top: 8px;
  padding-top: 10px;
  border-top: 1px solid rgba(255,255,255,.12);
  color: rgba(255,247,239,.82);
  font-size: 12px;
  line-height: 1.6;
}
.card.is-open .cardDetails{ display:block; }

/* close button */
.cardClose{
  position:absolute;
  right: 12px;
  top: 12px;
  width: 34px;
  height: 34px;
  border-radius: 12px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.18);
  color: rgba(255,247,239,.92);
  font-weight: 900;
  display:none;
  place-items:center;
  cursor:pointer;
  transition: transform .2s var(--ease), background .2s var(--ease), border-color .2s var(--ease);
}
.card.is-open .cardClose{ display:grid; }
.cardClose:hover{
  transform: translateY(-2px);
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.24);
}
    .tags{
      margin-top:auto;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .tag{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      color: rgba(255,247,239,.92);
      padding: 7px 10px;
      border-radius: 999px;
      font-weight:800;
      font-size: 11px;
      cursor:pointer;
      user-select:none;
      transition: transform .18s var(--ease), border-color .18s var(--ease), background .18s var(--ease);
    }
    .tag:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
    }
    .tag.active{
      background: linear-gradient(180deg, color-mix(in oklab, var(--glow1) 22%, transparent), rgba(255,255,255,.06));
      border-color: rgba(255,255,255,.25);
    }

    .span6{ grid-column: span 6; }
    .span8{ grid-column: span 8; }
    .span12{ grid-column: span 12; }
    @media (max-width: 900px){
      .span6,.span8{ grid-column: span 6; }
      .span12{ grid-column: span 6; }
    }
    @media (max-width: 560px){
      .card{ grid-column: span 1 !important; }
    }

    /* Controls row */
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* Sliders / selects */
    .control{
      width:100%;
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:4px;
    }
    .control label{
      font-size: 12px;
      color: rgba(255,247,239,.82);
      font-weight:800;
      letter-spacing:.2px;
    }
    input[type="range"]{
      width:100%;
      accent-color: color-mix(in oklab, var(--glow1) 72%, white);
      cursor:pointer;
    }
    select{
      width:100%;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      color: var(--text);
      font-weight:800;
      cursor:pointer;
      outline:none;
    }

    /* Terminal */
    .terminal{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      padding: 12px 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 12px;
      line-height:1.55;
      color: rgba(255,247,239,.88);
      box-shadow: 0 16px 44px rgba(0,0,0,.45);
    }
    .termLine{
      display:flex;
      gap:8px;
      align-items:flex-start;
      margin: 4px 0;
    }
    .prompt{ color: rgba(127,231,255,.9); font-weight:900; }
    .cmd{ color: rgba(255,208,139,.95); font-weight:900; cursor:pointer; }
    .cmd:hover{ text-decoration: underline; }

    /* Map buttons */
    .mapBtns{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      color: rgba(255,247,239,.92);
      font-weight:900;
      font-size: 11px;
      cursor:pointer;
      transition: transform .18s var(--ease), background .18s var(--ease), border-color .18s var(--ease);
      user-select:none;
    }
    .chip:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.08); }
    .chip.active{
      background: linear-gradient(180deg, color-mix(in oklab, var(--glow2) 20%, transparent), rgba(255,255,255,.06));
      border-color: rgba(255,255,255,.24);
    }

    /* Lore flipbook */
    .flip{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-top: 6px;
    }
    .page{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      padding: 12px 12px;
      min-height: 110px;
      flex:1;
      position:relative;
      overflow:hidden;
    }
    .page::before{
      content:"";
      position:absolute;
      inset:-40% -30%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
      transform: rotate(-18deg);
      opacity:.35;
      pointer-events:none;
    }
    .pageTitle{
      font-weight:900;
      font-size: 12px;
      letter-spacing:.3px;
      margin: 0 0 6px 0;
      color: rgba(255,247,239,.95);
    }
    .pageText{
      margin:0;
      color: rgba(255,247,239,.82);
      font-size: 12px;
      line-height:1.55;
      position:relative;
      z-index:1;
    }
    .miniBtn{
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight:900;
      font-size: 12px;
      cursor:pointer;
      transition: transform .2s var(--ease), border-color .2s var(--ease), background .2s var(--ease);
      user-select:none;
      white-space:nowrap;
    }
    .miniBtn:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.09); }

    /* Stickers */
    .stickers{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:6px;
    }
    .sticker{
      width: 46px;
      height: 46px;
      display:grid;
      place-items:center;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      cursor:pointer;
      user-select:none;
      transition: transform .18s var(--ease), border-color .18s var(--ease), background .18s var(--ease), filter .18s var(--ease);
      font-size: 20px;
    }
    .sticker:hover{ transform: translateY(-2px) rotate(-2deg); border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.08); }
    .sticker.collected{
      background: linear-gradient(180deg, color-mix(in oklab, var(--glow1) 18%, transparent), rgba(255,255,255,.06));
      border-color: rgba(255,255,255,.26);
      filter: brightness(1.06);
    }
    .progress{
      margin-top:6px;
      font-size: 12px;
      color: rgba(255,247,239,.82);
      font-weight:800;
    }

    /* Gallery thumbs */
    .thumbs{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:6px;
    }
    .thumb{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      overflow:hidden;
      cursor:pointer;
      position:relative;
      aspect-ratio: 16/10;
      box-shadow: 0 14px 40px rgba(0,0,0,.38);
      transition: transform .2s var(--ease), border-color .2s var(--ease), filter .2s var(--ease);
    }
    .thumb:hover{ transform: translateY(-3px); border-color: rgba(255,255,255,.22); filter: brightness(1.06); }
    .thumb img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }
    .thumb .ph{
      width:100%;
      height:100%;
      background:
        radial-gradient(closest-side at 30% 30%, color-mix(in oklab, var(--glow2) 22%, transparent), transparent 65%),
        radial-gradient(closest-side at 70% 70%, color-mix(in oklab, var(--glow3) 16%, transparent), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.12));
    }
    .thumbCap{
      position:absolute;
      left:10px; right:10px; bottom:10px;
      font-size: 11px;
      font-weight:900;
      color: rgba(255,247,239,.92);
      text-shadow: 0 8px 30px rgba(0,0,0,.65);
      letter-spacing:.2px;
    }

    /* Lightbox */
    .lightbox{
      position:fixed; inset:0;
      background: rgba(0,0,0,.68);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 22px;
      z-index: 9999;
    }
    .lightbox.open{ display:flex; }
    .lbCard{
      width:min(980px, 100%);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(10,6,6,.72);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 30px 110px rgba(0,0,0,.65);
      overflow:hidden;
      position:relative;
    }
    .lbTop{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      align-items:center;
    }
    .lbTitle{
      font-weight:900;
      letter-spacing:.25px;
      font-size: 12px;
      color: rgba(255,247,239,.9);
    }
    .lbClose{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 14px;
      padding: 8px 10px;
      font-weight:900;
      cursor:pointer;
    }
    .lbBody{
      padding: 12px;
      display:grid;
      gap:12px;
    }
    .lbBody img{
      width:100%;
      height:auto;
      display:block;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .lbNote{
      font-size: 12px;
      color: rgba(255,247,239,.78);
      line-height:1.55;
      padding: 0 2px 2px;
    }

    /* Mascot helper */
    .mascot{
      position:fixed;
      left: clamp(14px, 2vw, 22px);
      bottom: clamp(14px, 2vw, 22px);
      z-index: 9997;
      display:flex;
      gap:10px;
      align-items:flex-end;
      pointer-events:none;
    }
    .mascot .face{
      width: 54px; height: 54px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.16);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.22), transparent 55%),
        linear-gradient(180deg, color-mix(in oklab, var(--glow1) 18%, transparent), rgba(0,0,0,.16));
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      display:grid;
      place-items:center;
      font-size: 22px;
      pointer-events:auto;
      cursor:pointer;
      user-select:none;
    }
    .mascot .bubble{
      max-width: min(360px, 70vw);
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      padding: 10px 12px;
      color: rgba(255,247,239,.86);
      font-size: 12px;
      line-height:1.45;
      opacity:0;
      transform: translateY(6px);
      transition: opacity .25s var(--ease), transform .25s var(--ease);
      pointer-events:none;
    }
    .mascot.show .bubble{
      opacity:1;
      transform: translateY(0);
    }
    .mascot .bubble b{ color: rgba(255,247,239,.95); }

    /* Confetti particles */
    .confetti{
      position:fixed;
      left:0; top:0;
      width:8px; height:8px;
      border-radius: 6px;
      pointer-events:none;
      z-index: 9996;
      background: rgba(255,255,255,.9);
      box-shadow: 0 0 18px rgba(255,255,255,.22);
      opacity:.9;
    }

    footer{
      margin-top: 18px;
      padding: 18px 0 34px;
      color: rgba(255,247,239,.7);
      font-size: 12px;
    }
    .foot{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      border-top: 1px solid rgba(255,255,255,.12);
      padding-top: 16px;
    }
    .mini{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .mini a{
      color: rgba(255,247,239,.82);
      text-decoration:none;
      border-bottom: 1px dashed rgba(255,255,255,.22);
    }
    .mini a:hover{ opacity:.9; }

    /* Copy toast (was referenced in JS but missing before) */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 22px;
      transform: translateX(-50%);
      z-index: 9999;
      display:none;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: rgba(255,247,239,.92);
      font-weight:900;
      font-size: 12px;
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
      .cursor, .sparkles { display:none !important; }
      .hamuTrail{ display:none !important; }
    }

    /* =========================
       ADD-ON PACK (no removals)
       10 Ideas ‚Äî Hamu Dango
       ========================= */

    /* Floating candy background layer */
    .candies{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-6;
      opacity:.42;
      filter: drop-shadow(0 14px 26px rgba(0,0,0,.35));
    }
    .candy{
      position:absolute;
      width: 56px;
      height: 56px;
      border-radius: 18px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.7), rgba(255,255,255,0) 55%),
        linear-gradient(135deg, rgba(255,179,107,.85), rgba(255,138,180,.75));
      border: 1px solid rgba(255,255,255,.18);
      transform: translateY(0) rotate(0deg);
      animation: candyFloat var(--floatCandySpeed, 18s) var(--ease) infinite;
      will-change: transform, opacity;
    }
    .candy::after{
      content:"";
      position:absolute; inset:10px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.20), rgba(0,0,0,0));
      opacity:.65;
    }
    .candy.twist{
      border-radius: 999px;
      width: 64px; height: 42px;
      background:
        repeating-linear-gradient(45deg, rgba(255,255,255,.25) 0 8px, rgba(255,255,255,0) 8px 16px),
        linear-gradient(135deg, rgba(127,231,255,.70), rgba(255,208,139,.80));
    }
    .candy.lolli{
      border-radius: 999px;
      width: 52px; height: 52px;
      background:
        conic-gradient(from 30deg, rgba(255,179,107,.95), rgba(255,208,139,.95), rgba(255,138,180,.95), rgba(127,231,255,.85), rgba(255,179,107,.95));
    }
    @keyframes candyFloat{
      0%{ transform: translateY(0) translateX(0) rotate(0deg) scale(.98); opacity:.45; }
      50%{ transform: translateY(-28px) translateX(16px) rotate(10deg) scale(1.03); opacity:.65; }
      100%{ transform: translateY(0) translateX(0) rotate(0deg) scale(.99); opacity:.48; }
    }

    /* Smooth Mouse Trail */
    .hamuTrail{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9998;
      opacity: .95;
    }
    .hamuTrailDot{
      position: absolute;
      left: 0; top: 0;
      width: 12px;
      height: 12px;
      border-radius: 999px;
      transform: translate(-50%,-50%);
      will-change: transform, opacity;
      mix-blend-mode: screen;
      opacity: .9;
    }
    
/* Extras video */
.videoCard{
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.16);
  overflow:hidden;
  box-shadow: 0 18px 50px rgba(0,0,0,.35);
}
.videoFrame{
  aspect-ratio: 16/9;
  width:100%;
  display:block;
  border:0;
  background: rgba(0,0,0,.22);
}
.videoMeta{
  padding: 12px 12px 12px;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
}
.videoMeta b{
  display:block;
  font-size: 12px;
  font-weight: 900;
  letter-spacing:.2px;
}
.videoMeta span{
  display:block;
  margin-top:4px;
  font-size: 11px;
  color: rgba(255,247,239,.72);
  font-weight:800;
}
.videoMeta .miniBtn{
  padding: 9px 10px;
  border-radius: 14px;
  font-size: 12px;
}
/* Extra background particles (fast canvas layer) */
.particleCanvas{
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: -5; /* above .bg (-6), below UI */
  pointer-events: none;
  opacity: .9;
  mix-blend-mode: screen;
}
@media (prefers-reduced-motion: reduce){
  .particleCanvas{ display:none !important; }
}
/* ===== Support Buttons ===== */
.supportBtns{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}

.supportBtn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding: 11px 14px;
  border-radius: 16px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.18);
  color: var(--text);
  text-decoration:none;
  font-weight:900;
  font-size: 12px;
  letter-spacing:.2px;
  transition: transform .22s var(--ease),
              border-color .22s var(--ease),
              background .22s var(--ease),
              box-shadow .22s var(--ease);
  box-shadow: 0 14px 40px rgba(0,0,0,.35);
}

.supportBtn:hover{
  transform: translateY(-3px);
  border-color: rgba(255,255,255,.26);
  background: rgba(255,255,255,.08);
  box-shadow: 0 22px 60px rgba(0,0,0,.5);
  filter: brightness(1.06);
}

/* subtle color accents */
.supportBtn.discord{
  background: linear-gradient(180deg, rgba(88,101,242,.22), rgba(0,0,0,.18));
}
.supportBtn.twitter{
  background: linear-gradient(180deg, rgba(29,155,240,.22), rgba(0,0,0,.18));
}
.supportBtn.kofi{
  background: linear-gradient(180deg, rgba(255,94,94,.22), rgba(0,0,0,.18));
}
  </style>
</head>

<body data-live="0">
  <div class="bg"></div>
<canvas id="particleCanvas" class="particleCanvas" aria-hidden="true"></canvas>
  <!-- Floating candies -->
  <div class="candies" aria-hidden="true">
    <div class="candy lolli" style="left:8%; top:18%;"></div>
    <div class="candy twist" style="left:18%; top:62%; opacity:.34;"></div>
    <div class="candy"       style="left:32%; top:10%; opacity:.32;"></div>
    <div class="candy lolli" style="left:46%; top:74%; opacity:.30;"></div>
    <div class="candy"       style="left:58%; top:22%; opacity:.28;"></div>
    <div class="candy twist" style="left:70%; top:60%; opacity:.26;"></div>
    <div class="candy lolli" style="left:82%; top:16%; opacity:.30;"></div>
    <div class="candy"       style="left:88%; top:78%; opacity:.24;"></div>
    
  </div>

  <!-- Live badge -->
  <div class="liveBadge" id="liveBadge" title="Click to toggle Live/Offline (for now)">
    <span class="liveDot" aria-hidden="true"></span>
    <span class="liveStack">
      <span class="liveText" id="liveText">OFFLINE</span>
      <span class="liveSub" id="liveSub">cozy warm mode</span>
    </span>
  </div>

  <!-- Mouse follower -->
  <div class="cursor" id="cursor" aria-hidden="true"></div>

  <!-- Smooth Mouse Trail -->
  <div class="hamuTrail" id="hamuTrail" aria-hidden="true"></div>

  <!-- Sparkles -->
  <div class="sparkles" aria-hidden="true" id="sparkles">
    <i style="left:10%; top:18%; animation-duration: 9s;"></i>
    <i style="left:18%; top:42%; animation-duration: 11s; width:7px; height:7px;"></i>
    <i style="left:28%; top:24%; animation-duration: 10.5s;"></i>
    <i style="left:38%; top:66%; animation-duration: 12.5s;"></i>
    <i style="left:52%; top:16%; animation-duration: 9.5s; width:8px; height:8px;"></i>
    <i style="left:64%; top:30%; animation-duration: 11.5s;"></i>
    <i style="left:78%; top:20%; animation-duration: 10.2s; width:7px; height:7px;"></i>
    <i style="left:84%; top:40%; animation-duration: 13s;"></i>
    <i style="left:72%; top:74%; animation-duration: 12s;"></i>
    <i style="left:24%; top:80%; animation-duration: 13.5s;"></i>
  </div>

  <!-- Mascot helper -->
  <div class="mascot" id="mascot">
    <div class="face" id="mascotBtn" title="Click me!">üç°</div>
    <div class="bubble" id="mascotBubble"></div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lbCard" role="dialog" aria-modal="true" aria-label="Gallery viewer">
      <div class="lbTop">
        <div class="lbTitle" id="lbTitle">Gallery</div>
        <button class="lbClose" id="lbClose">Close</button>
      </div>
      <div class="lbBody">
        <img id="lbImg" alt="" />
        <div class="lbNote" id="lbNote"></div>
      </div>
    </div>
  </div>

  <!-- Copy Toast (was missing) -->
  <div class="toast" id="copyToast">Copied</div>

  <div class="wrap">
    <!-- Top bar -->
    <div class="topbar">
      <div class="brand">
        <div class="dot"></div>
        <div class="stack">
          <div class="title">HAMU DANGO</div>
          <div class="sub">Kuroveil ‚Ä¢ Dangoland‚Äôs sweetest chaos</div>
        </div>
      </div>

      <div class="nav">
        <div class="door" id="doorBtn" title="Door #017">
          <span class="frame" aria-hidden="true"></span>
          <span class="code">#017</span>
        </div>

        <!-- ‚úÖ SFX pill -->
        <div class="audioPill" title="Toggle SFX">
          <b>SFX</b>
          <div class="toggle on" id="sfxToggle" role="switch" aria-checked="true" tabindex="0"></div>
          <!-- keep slider element for JS safety (hidden by CSS) -->
          <input class="vol" id="sfxVol" type="range" min="0" max="100" value="55" aria-label="SFX volume"/>
        </div>

        <button class="btn" data-scroll="#about">Lore</button>
        <button class="btn" data-scroll="#content">Content</button>
        <button class="btn" data-scroll="#socials">Socials</button>
        <button class="btn" data-scroll="#extras">Extras</button>
        <button class="btn" id="showAllBtn">Show All</button>
      </div>
    </div>

    <!-- ‚úÖ HERO (FIXED): ONLY ONE hero section, properly closed, 2-column siblings -->
    <section class="hero" id="about">
      <!-- LEFT COLUMN -->
      <div class="panel">
        <div class="inner">
          <h1 class="heroTitle">Hamu Dango</h1>

          <div class="heroK">
            <span class="pill"><b>Origin</b> Dangoland</span>
            <span class="pill"><b>Role</b> Jester / Entertainer</span>
            <span class="pill"><b>Vibe</b> Warm ‚Ä¢ Playful ‚Ä¢ Cozy Chaos</span>
          </div>

          <div class="lore">
            <p>
              A mix of both a <strong>rat</strong> and a <strong>hamster</strong>, coming directly from the sweetest corners of
              <strong>DANGOLAND</strong>!
            </p>
            <p>
              ...As nice as it may seem, living in a world where everything is sweet it can also be quite boring.
              After all, sweet n‚Äô dandiness does need some <strong>chaos</strong> and <strong>mischief</strong>!
            </p>
            <p>
              Determined to make her life more interesting, she pursued the <strong>‚Äúentertainer lifestyle‚Äù</strong>
              which in Dangoland is more or less similar to being a <strong>Jester</strong>.
            </p>
            <p>
              One day, upon seeing a strange phenomenon called <strong>‚ÄúLivestreaming‚Äù</strong>, she decided that
              <strong>THIS</strong> was her calling‚Ä¶ so she could cause as much chaos as possible with a smile.
            </p>
          </div>

          <div class="ctaRow" id="socials">
            <a class="cta"
               href="https://twitch.tv/HamuDangoVT"
               target="_blank"
               rel="noopener noreferrer">‚ú® Watch Live</a>

            <a class="cta secondary"
               href="https://youtube.com/@HamuDangoVT"
               target="_blank"
               rel="noopener noreferrer">üç¨ Clips & Highlights</a>

            <a class="cta secondary"
               href="https://discord.gg/ahbekpPkur"
               target="_blank"
               rel="noopener noreferrer">üíõ Join Kuroveil</a>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="panel art" aria-label="Hamu artwork panel">
        <div class="stage">
          <div class="stageTop">
            <div class="stageBadge">
              <span class="spark" aria-hidden="true"></span>
              <span class="txt">
                <b>Dangoland Stage</b>
                <span>featured art + quick vibes</span>
              </span>
            </div>
            <div class="stageHint">cute picture of Hamu Dango</div>
          </div>

          <div class="stageMain" id="stageMain">
            <img class="stageAI" id="stageAI" src="cutehamu.png" alt="Dangoland AI scene" />
            <div class="imgFallback" id="imgFallback" style="display:none;">
              <div>
                <b>Art panel is ready</b>
                <div class="small">Place <code>hamustare.png</code> and <code>sussyhamu.png</code> in the same folder as this HTML.</div>
                <div class="small">(Your gallery uses <code>Hamu Image.png</code> too.)</div>
              </div>
            </div>
          </div>

          <div class="stageBottom">
            <div class="stagePills">
              <div class="miniPill" id="stagePop">üç¨ pop confetti</div>
              <div class="miniPill" data-scroll="#extras">‚ú® jump to extras</div>
              <div class="miniPill" data-scroll="#content">üé≠ jump to cards</div>
            </div>
            <div class="pill"><b>Mode</b> warm & playful</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Cards -->
    <section class="grid" id="content" aria-label="Hamu sections">
      <article class="card span6" data-tags="social support community">
  <div class="in">
    <h3>üíõ Join & Support Hamu</h3>
    <p>Become part of Dangoland! Hang out in Discord, follow the chaos on Twitter, or fuel the sweet mischief on Ko-fi.</p>

    <div class="supportBtns">
      <a class="supportBtn discord"
         href="https://discord.gg/ssjKCJSAus"
         target="_blank"
         rel="noopener noreferrer">
        üí¨ Join Discord
      </a>

      <a class="supportBtn twitter"
         href="https://x.com/HamuDangoVT"
         target="_blank"
         rel="noopener noreferrer">
        üê¶ Follow on Twitter
      </a>

      <a class="supportBtn kofi"
         href="https://ko-fi.com/HamuDango"
         target="_blank"
         rel="noopener noreferrer">
        ‚òï Support on Ko-fi
      </a>
    </div>

    <div class="cardDetails">
      Support helps Hamu upgrade her cozy chaos ‚Äî art, emotes, stream surprises, and more sweet mischief üç°
    </div>
  </div>
</article>

      <article class="card" data-tags="chat interactive chaos">
        <div class="in">
          <h3>ü´ß Chat Mischief</h3>
          <p>Games, bits, and interactive moments where chat gets to poke the jester brain and watch the plan explode (nicely).</p>
          <div class="tags">
            <span class="tag" data-filter="chat">Chat</span>
            <span class="tag" data-filter="interactive">Interactive</span>
            <span class="tag" data-filter="chaos">Chaos</span>
          </div>
        </div>
      </article>

      <article class="card" data-tags="cozy art aesthetic">
        <div class="in">
          <h3>üïØÔ∏è Warm & Cozy Vibe</h3>
          <p>Soft lighting, warm colors, comfy energy but always playful. Like a cuddle‚Ä¶ with a prank hidden inside.</p>
          <div class="tags">
            <span class="tag" data-filter="cozy">Cozy</span>
            <span class="tag" data-filter="art">Art</span>
            <span class="tag" data-filter="aesthetic">Aesthetic</span>
          </div>
        </div>
      </article>

      <article class="card" data-tags="schedule updates streaming">
        <div class="in">
          <h3>üìÖ Schedule & Updates</h3>
          <p>Drop schedule notes here (or ‚Äúsurprise streams‚Äù if that‚Äôs more Hamu). Keep it simple and readable for visitors.</p>
          <div class="tags">
            <span class="tag" data-filter="schedule">Schedule</span>
            <span class="tag" data-filter="updates">Updates</span>
            <span class="tag" data-filter="streaming">Streaming</span>
          </div>
        </div>
      </article>

      <article class="card" data-tags="music fun interactive">
        <div class="in">
          <h3>üé∂ Sweet Sounds</h3>
          <p>Playlist vibes for cozy chaos background sweetness with playful sparkles.</p>
          <div class="tags">
            <span class="tag" data-filter="music">Music</span>
            <span class="tag" data-filter="fun">Fun</span>
            <span class="tag" data-filter="interactive">Interactive</span>
          </div>
        </div>
      </article>

      <!-- ===== add-on cards kept ===== -->
      <article class="card span6" data-tags="map lore cozy">
        <div class="in">
          <h3>üó∫Ô∏è Dangoland Map</h3>
          <p>Tap a location to highlight matching sections. (Tap again to clear.)</p>
          <div class="mapBtns" style="margin-top:6px;">
            <span class="chip" data-map="plaza">üç¨ Candy Plaza</span>
            <span class="chip" data-map="stage">üé≠ Jester Stage</span>
            <span class="chip" data-map="woods">üåø Sugar Woods</span>
          </div>
          <div class="progress" id="mapHint">No location selected.</div>
        </div>
      </article>

      <article class="card span6" data-tags="controls chaos">
        <div class="in">
          <h3>üéöÔ∏è Chaos Meter</h3>
          <p>Cozy ‚Üí Mischief ‚Üí Maximum Chaos. This changes sparkles + card wiggle + click confetti intensity.</p>
          <div class="control">
            <label for="chaosRange">Chaos level: <span id="chaosLabel">35</span>%</label>
            <input id="chaosRange" type="range" min="0" max="100" value="35" />
          </div>
        </div>
      </article>

      <article class="card span6" data-tags="controls cozy aesthetic">
        <div class="in">
          <h3>üåÖ Theme Switch</h3>
          <p>Swap vibes without breaking the warm cozy feel.</p>
          <div class="control">
            <label for="themeSelect">Choose a theme</label>
            <select id="themeSelect">
              <option value="sunset">Sunset Warm</option>
              <option value="candle">Candlelight</option>
              <option value="cotton">Cotton Candy (warm)</option>
            </select>
          </div>
        </div>
      </article>

      <article class="card span6" data-tags="lore flipbook cozy">
        <div class="in">
          <h3>üìñ Lore Flipbook</h3>
          <p>Little collectible ‚Äúpages‚Äù of Hamu‚Äôs story.</p>
          <div class="flip">
            <button class="miniBtn" id="pagePrev">‚óÄ</button>
            <div class="page">
              <div class="pageTitle" id="pageTitle">Page 1</div>
              <p class="pageText" id="pageText"></p>
            </div>
            <button class="miniBtn" id="pageNext">‚ñ∂</button>
          </div>
        </div>
      </article>

      <article class="card span6" data-tags="lore cozy aesthetic">
        <div class="in">
          <h3>üç° Hamu Mood</h3>
          <p>Current vibe from Dangoland:</p>

          <div class="terminal">
            <div class="termLine">
              <span class="prompt">status@hamu</span><span>:</span>
              <span class="cmd" id="hamuMoodText" style="cursor:default;">Cozy‚Ä¶ but plotting something.</span>
            </div>
          </div>

          <div class="row" style="margin-top:8px;">
            <button class="miniBtn" id="moodNext">Next Mood</button>
          </div>

          <div class="progress" style="opacity:.9;">The hamster rat's current mood is</div>
        </div>
      </article>

      <article class="card span6" data-tags="stickers fun cozy">
        <div class="in">
          <h3>üß∑ Stamps / Stickers</h3>
          <p>Click to collect. Saved in your browser.</p>
          <div class="stickers" id="stickers">
            <div class="sticker" data-id="dango" title="Dango">üç°</div>
            <div class="sticker" data-id="star" title="Star">‚≠ê</div>
            <div class="sticker" data-id="mask" title="Jester">üé≠</div>
            <div class="sticker" data-id="heart" title="Sweet">üíõ</div>
            <div class="sticker" data-id="sparkle" title="Sparkle">‚ú®</div>
            <div class="sticker" data-id="paw" title="Tiny paws">üêæ</div>
            <div class="sticker" data-id="candy" title="Candy">üç¨</div>
            <div class="sticker" data-id="leaf" title="Sugar Woods">üçÉ</div>
            <div class="sticker" data-id="music" title="Music">üé∂</div>
            <div class="sticker" data-id="moon" title="Night snack">üåô</div>
          </div>
          <div class="progress" id="stampProgress">Collected: 0/10</div>
          <div class="row" style="margin-top:8px;">
            <button class="miniBtn" id="stampReset">Reset</button>
          </div>
        </div>
      </article>

      <article class="card span6" data-tags="gallery art aesthetic">
        <div class="in">
          <h3>üñºÔ∏è Gallery</h3>
          <p>Click a thumbnail to open the warm lightbox viewer.</p>
          <div class="thumbs" id="thumbs">
            <div class="thumb" data-title="Hamu Warm Ref" data-src="Hamu Image.png" data-note="The hamrat's innocent smile hides a mischievous soul.">
              <img src="Hamu Image.png" alt="Hamu warm ref" onerror="this.remove(); this.parentElement.insertAdjacentHTML('afterbegin','<div class=&quot;ph&quot;></div>');">
              <div class="thumbCap">Warm Ref</div>
            </div>

            <div class="thumb" data-title="Sussyhamu" data-src="sussyhamu.png" data-note="Sussyhamu ready to cause some cozy chaos.">
              <img src="sussyhamu.png" alt="Sussyhamu" onerror="this.remove(); this.parentElement.insertAdjacentHTML('afterbegin','<div class=&quot;ph&quot;></div>');">
              <div class="thumbCap">Sussyhamu</div>
            </div>

            <div class="thumb" data-title="Hamustare" data-src="hamustare.png" data-note="Hamustare gazing into your soul, plotting the next playful prank.">
              <img src="hamustare.png" alt="Hamustare" onerror="this.remove(); this.parentElement.insertAdjacentHTML('afterbegin','<div class=&quot;ph&quot;></div>');">
              <div class="thumbCap">Hamustare</div>
            </div>
          </div>
        </div>
      </article>

      <article class="card span6" data-tags="effects fun">
        <div class="in">
          <h3>üç¨ Candy Confetti</h3>
          <p>Whenever you click buttons/cards/tags, tiny warm confetti pops. (Intensity is tied to Chaos Meter.)</p>
          <div class="row" style="margin-top:6px;">
            <button class="miniBtn" id="testConfetti">Test pop</button>
            <button class="miniBtn" id="toggleConfetti">Confetti: ON</button>
          </div>
        </div>
      </article>

      <article class="card span6" data-tags="helper fun">
        <div class="in">
          <h3>üç° Hamu Helper</h3>
          <p>The little üç° buddy in the corner gives tips. Click it to cycle messages (and to shut it up).</p>
          <div class="row" style="margin-top:6px;">
            <button class="miniBtn" id="helperToggle">Helper: ON</button>
            <button class="miniBtn" id="helperNext">Next tip</button>
          </div>
          <div class="progress">Tip shows bottom-left.</div>
        </div>
      </article>

      <article class="card span12" id="extras" data-tags="art lore cozy">
        <div class="in" style="gap:14px;">
          <h3>üç° Hamu Gallery / Extras</h3>
          <p>This area is for your bigger showcase moments: key art, featured clips, or a ‚ÄúWelcome to Dangoland‚Äù banner.</p>

          <div style="display:flex; gap:14px; flex-wrap:wrap; align-items:flex-end;">
            <div style="flex:1 1 360px; min-width:260px;">
  <div class="pill" style="display:inline-flex; margin-bottom:10px;">
    <b>Featured</b> warm clip
  </div>

  <div style="
    border-radius:18px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.16);
    overflow:hidden;
    box-shadow: 0 18px 50px rgba(0,0,0,.35);
  ">
      <a
  href="https://www.youtube.com/watch?v=Bph3wtkndTc"
  target="_blank"
  rel="noopener noreferrer"
  style="
    display:block;
    position:relative;
    width:100%;
    aspect-ratio:16/9;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.14);
    overflow:hidden;
    box-shadow: 0 18px 50px rgba(0,0,0,.35);
    background:
      radial-gradient(900px 300px at 30% 20%, rgba(255,179,107,.18), transparent 60%),
      radial-gradient(900px 300px at 70% 70%, rgba(255,138,180,.14), transparent 65%),
      linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.18));
    text-decoration:none;
  "
>
  <!-- Thumbnail (more reliable size) -->
  <img
    src="https://img.youtube.com/vi/Bph3wtkndTc/hqdefault.jpg"
    alt="Watch on YouTube"
    style="width:100%; height:100%; object-fit:cover; display:block;"
  />

  <!-- Dark overlay -->
  <div style="
    position:absolute;
    inset:0;
    background: linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.45));
  "></div>

  <!-- Play button -->
  <div style="
    position:absolute;
    left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:84px; height:84px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.25);
    background: rgba(0,0,0,.45);
    backdrop-filter: blur(10px);
    display:grid;
    place-items:center;
    box-shadow: 0 18px 60px rgba(0,0,0,.45);
  ">
    <div style="
      width:0; height:0;
      border-left:22px solid rgba(255,255,255,.95);
      border-top:14px solid transparent;
      border-bottom:14px solid transparent;
      margin-left:4px;
    "></div>
  </div>

  <!-- Bottom label -->
  <div style="
    position:absolute;
    left:14px; right:14px; bottom:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    color: rgba(255,247,239,.95);
    font-weight:900;
    font-size:12px;
    letter-spacing:.2px;
    text-shadow: 0 10px 30px rgba(0,0,0,.65);
  ">
    <span>‚ñ∂ Watch on YouTube</span>
    <span style="opacity:.75;">opens in new tab</span>
  </div>
</a>
    <div style="padding:8px 12px; font-size:13px; color:rgba(255,247,239,.86);">
  ‚ú® Cozy vibes from Dangoland Hamu doing her thing!
</div>
  </div>
</div>
            <div style="flex:1 1 320px; min-width:260px;">
              <div style="
                border-radius: 18px;
                border: 1px solid rgba(255,255,255,.14);
                background: rgba(0,0,0,.16);
                overflow:hidden;
                box-shadow: 0 18px 50px rgba(0,0,0,.45);
              ">
                <img src="Hamu Image.png" alt="Hamu Dango warm reference image" style="width:100%; height:auto; display:block;" onerror="this.style.display='none'">
              </div>
            </div>
          </div>

          <div class="tags" style="margin-top:6px;">
            <span class="tag" data-filter="art">Art</span>
            <span class="tag" data-filter="lore">Lore</span>
            <span class="tag" data-filter="cozy">Cozy</span>
          </div>
        </div>
      </article>
    </section>

    <footer>
      <div class="foot">
        <div>¬© <span id="year"></span> Kuroveil ‚Ä¢ Hamu Dango</div>
        <div class="mini">
  <a href="https://kuroveil.com/roster.html">Roster</a>
  <a href="https://kuroveil.com/index.html">Kuroveil</a>
  <a href="https://x.com/veil_kuro11808" target="_blank" rel="noopener noreferrer">Contact</a>
</div>
      </div>
    </footer>
  </div>

  <!-- ===== SFX (optional mp3) ===== -->
  <audio id="sfxHover" preload="auto"><source src="hover.mp3" type="audio/mpeg"></audio>
  <audio id="sfxClick" preload="auto"><source src="click.mp3" type="audio/mpeg"></audio>
  <audio id="sfxDoor"  preload="auto"><source src="door.mp3"  type="audio/mpeg"></audio>

  <script>
    /* ===========================
   HOTFIX: #017 + BEEP SFX
   Paste at TOP of <script>
   =========================== */
(function(){
  const STORE_KEY = "hamu_sfx";

  const state = { enabled: true, vol: 0.55, ctx: null, unlocked: false };

  // Load saved state
  try{
    const st = JSON.parse(localStorage.getItem(STORE_KEY) || "{}");
    if(typeof st.enabled === "boolean") state.enabled = st.enabled;
    if(typeof st.vol === "number") state.vol = Math.max(0, Math.min(1, st.vol));
  }catch(e){}

  function save(){
    try{ localStorage.setItem(STORE_KEY, JSON.stringify({ enabled: state.enabled, vol: state.vol })); }catch(e){}
  }

  function getCtx(){
    if(state.ctx) return state.ctx;
    const AC = window.AudioContext || window.webkitAudioContext;
    if(!AC) return null;
    state.ctx = new AC();
    return state.ctx;
  }

  function ensureStarted(){
    const ctx = getCtx();
    if(!ctx) return false;
    if(ctx.state === "suspended") ctx.resume().catch(()=>{});
    return true;
  }

  function unlock(){
    if(state.unlocked) return;
    state.unlocked = true;
    ensureStarted();
  }

  // Beep-only SFX (no mp3 files needed)
  function beep(kind="click"){
    if(!state.enabled) return;
    if(!ensureStarted()) return;

    const ctx = state.ctx;
    const now = ctx.currentTime;

    const map = {
      hover: { f1: 740, f2: 980, dur: 0.05 },
      click: { f1: 520, f2: 680, dur: 0.07 },
      door:  { f1: 220, f2: 330, dur: 0.12 },
    };
    const cfg = map[kind] || map.click;

    const osc = ctx.createOscillator();
    const gain = ctx.createGain();

    osc.type = "triangle";
    osc.frequency.setValueAtTime(cfg.f1, now);
    osc.frequency.exponentialRampToValueAtTime(cfg.f2, now + cfg.dur);

    const v = Math.max(0.0001, (state.vol || 0.55) * 0.25);
    gain.gain.setValueAtTime(0.0001, now);
    gain.gain.exponentialRampToValueAtTime(v, now + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + cfg.dur);

    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start(now);
    osc.stop(now + cfg.dur + 0.02);
  }

  // Wait until elements exist, then bind (safe even if other code fails)
  function bind(){
    const doorBtn = document.getElementById("doorBtn");
    const sfxToggle = document.getElementById("sfxToggle");
    const sfxVol = document.getElementById("sfxVol");

    if(sfxToggle){
      sfxToggle.classList.toggle("on", !!state.enabled);
      sfxToggle.setAttribute("aria-checked", String(!!state.enabled));
      sfxToggle.addEventListener("click", (e)=>{
        e.preventDefault();
        unlock();
        state.enabled = !state.enabled;
        save();
        sfxToggle.classList.toggle("on", !!state.enabled);
        sfxToggle.setAttribute("aria-checked", String(!!state.enabled));
        if(state.enabled) beep("click");
      });

      sfxToggle.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          sfxToggle.click();
        }
      });
    }

    if(sfxVol){
      sfxVol.value = String(Math.round(state.vol * 100));
      sfxVol.addEventListener("input", ()=>{
        state.vol = Math.max(0, Math.min(1, Number(sfxVol.value)/100));
        save();
      });
    }

    if(doorBtn){
      // make sure it's clickable
      doorBtn.style.pointerEvents = "auto";

      doorBtn.addEventListener("click", (e)=>{
        unlock();
        beep("door");
        // keep your behavior: scroll to #about
        const about = document.getElementById("about");
        if(about) about.scrollIntoView({ behavior:"smooth", block:"start" });
      });
    }

    // Delegated hover/click beeps so you don't have to bind 200 elements
    document.addEventListener("pointerenter", (e)=>{
      const t = e.target && e.target.closest?.(".card, .btn, .cta, .tag, .door, .miniBtn, .chip, .thumb, .sticker, .liveBadge, .face, .toggle, .miniPill");
      if(!t) return;
      unlock();
      beep("hover");
    }, true);

    document.addEventListener("click", (e)=>{
      const t = e.target && e.target.closest?.(".card, .btn, .cta, .tag, .door, .miniBtn, .chip, .thumb, .sticker, .liveBadge, .face, .toggle, .miniPill");
      if(!t) return;
      unlock();
      beep("click");
    }, true);
  }

  // Unlock on first interaction (browser autoplay rules)
  window.addEventListener("pointerdown", unlock, { passive:true });
  window.addEventListener("keydown", unlock, { passive:true });

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", bind);
  }else{
    bind();
  }
})();
    // ===== Year
    document.getElementById("year").textContent = new Date().getFullYear();

    // =========================
    // ‚úÖ HARD FIXES INCLUDED
    // 1) Hero layout restored (no duplicate hero/stage markup)
    // 2) Missing elements fixed (#copyToast, #sfxVol exists even if hidden)
    // 3) Art panel fallback logic hardened (AI stage + main + float)
    // 4) SFX is consistent (toggle works + WebAudio fallback)
    // =========================

    // Emergency reset: press 0 to show everything again
    window.addEventListener("keydown", (e)=>{
      if(e.key !== "0") return;
      try{ localStorage.removeItem("hamu_map"); }catch(err){}
      document.querySelectorAll(".tag.active").forEach(t=>t.classList.remove("active"));
      document.querySelectorAll(".card[data-tags]").forEach(c=>c.style.display="block");
      document.querySelectorAll(".chip.active").forEach(c=>c.classList.remove("active"));
      const hint = document.getElementById("mapHint");
      if(hint) hint.textContent = "No location selected.";
    });

    // ===== Smooth scroll
    document.querySelectorAll("[data-scroll]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const sel = btn.getAttribute("data-scroll");
        const el = document.querySelector(sel);
        if(!el) return;
        playBeep("click");
        el.scrollIntoView({behavior:"smooth", block:"start"});
      });
    });

    // ===== Mouse follower
    const cursor = document.getElementById("cursor");
    let cx = window.innerWidth/2, cy = window.innerHeight/2;
    let tx = cx, ty = cy;
    function raf(){
      cx += (tx - cx) * 0.16;
      cy += (ty - cy) * 0.16;
      cursor.style.left = cx + "px";
      cursor.style.top  = cy + "px";
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);

    window.addEventListener("mousemove", (e)=>{
      tx = e.clientX;
      ty = e.clientY;
      cursor.classList.remove("hide");
    }, {passive:true});
    window.addEventListener("mouseleave", ()=> cursor.classList.add("hide"));

    // =========================
    // ‚úÖ SFX (toggle + fallback)
    // =========================
    const sfxEls = {
      hover: document.getElementById("sfxHover"),
      click: document.getElementById("sfxClick"),
      door:  document.getElementById("sfxDoor")
    };

    const SFX = { enabled: false, vol: 0.55, ctx: null, unlocked:false };

    function getCtx(){
      if(SFX.ctx) return SFX.ctx;
      const AC = window.AudioContext || window.webkitAudioContext;
      if(!AC) return null;
      SFX.ctx = new AC();
      return SFX.ctx;
    }
    function ensureAudioStarted(){
      const ctx = getCtx();
      if(!ctx) return false;
      if(ctx.state === "suspended") ctx.resume().catch(()=>{});
      return true;
    }
    function unlockAudio(){
      if(SFX.unlocked) return;
      SFX.unlocked = true;
      ensureAudioStarted();
      // prime <audio> tags (safe if missing files)
      Object.values(sfxEls).forEach(a=>{
        if(!a) return;
        try{
          a.volume = SFX.vol;
          a.play().then(()=>{ a.pause(); a.currentTime = 0; }).catch(()=>{});
        }catch(e){}
      });
    }
    window.addEventListener("pointerdown", unlockAudio, {passive:true});
    window.addEventListener("keydown", unlockAudio, {passive:true});

    function playBeep(kind="click"){
      if(!SFX.enabled) return;
      const ok = ensureAudioStarted();
      if(!ok) return;

      const ctx = SFX.ctx;
      const now = ctx.currentTime;
      const map = {
        hover: {f1: 740, f2: 980, dur: 0.05},
        click: {f1: 520, f2: 680, dur: 0.07},
        door:  {f1: 220, f2: 330, dur: 0.12}
      };
      const cfg = map[kind] || map.click;

      const osc = ctx.createOscillator();
      const gain = ctx.createGain();

      osc.type = "triangle";
      osc.frequency.setValueAtTime(cfg.f1, now);
      osc.frequency.exponentialRampToValueAtTime(cfg.f2, now + cfg.dur);

      const v = Math.max(0.0001, SFX.vol * 0.25);
      gain.gain.setValueAtTime(0.0001, now);
      gain.gain.exponentialRampToValueAtTime(v, now + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + cfg.dur);

      osc.connect(gain);
      gain.connect(ctx.destination);

      osc.start(now);
      osc.stop(now + cfg.dur + 0.02);
    }

    function playSfx(name){
      if(!SFX.enabled) return;
      if(!SFX.unlocked) unlockAudio();

      const a = sfxEls[name];
      if(a){
        try{
          a.volume = SFX.vol;
          a.currentTime = 0;
          const p = a.play();
          if(p && typeof p.catch === "function") p.catch(()=> playBeep(name));
          return;
        }catch(e){
          playBeep(name);
          return;
        }
      }
      playBeep(name);
    }

    function applySfxUi(){
      const t = document.getElementById("sfxToggle");
      const v = document.getElementById("sfxVol");
      if(t){
        t.classList.toggle("on", SFX.enabled);
        t.setAttribute("aria-checked", String(SFX.enabled));
      }
      if(v){
        v.value = String(Math.round(SFX.vol * 100));
      }
      Object.values(sfxEls).forEach(a=>{ try{ if(a) a.volume = SFX.vol; }catch(e){} });
    }
    applySfxUi();

    // Toggle handlers (SAFE even if slider is hidden/removed)
(function(){
  const t = document.getElementById("sfxToggle");
  const v = document.getElementById("sfxVol"); // may exist but be hidden (that's fine)
  if(!t) return;

  function setUI(){
    t.classList.toggle("on", !!SFX.enabled);
    t.setAttribute("aria-checked", String(!!SFX.enabled));
    if(v) v.value = String(Math.round((SFX.vol ?? 0.55) * 100));
  }

  function toggle(){
    // unlock audio on first real gesture
    try{ unlockAudio?.(); }catch(e){}

    SFX.enabled = !SFX.enabled;
    saveSfx();
    setUI();

    // give immediate feedback if turning on
    if(SFX.enabled) playBeep("click");
  }

  // initial UI sync
  setUI();

  // click + keyboard accessible
  t.addEventListener("click", (e)=>{ e.preventDefault(); toggle(); });
  t.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      toggle();
    }
  });

  // optional volume (kept safe)
  if(v){
    v.addEventListener("input", ()=>{
      SFX.vol = Math.max(0, Math.min(1, Number(v.value)/100));
      saveSfx();
      setUI();
    });
    v.addEventListener("pointerdown", (e)=> e.stopPropagation());
    v.addEventListener("click", (e)=> e.stopPropagation());
  }
})();

    // Attach hover + click SFX
    (function bindSfx(){
      const hoverables = [
        ...document.querySelectorAll(".card, .btn, .cta, .tag, .door, .miniBtn, .chip, .thumb, .sticker, .liveBadge, .face, .toggle, .miniPill")
      ];
      hoverables.forEach(el=>{
        el.addEventListener("pointerenter", ()=> playSfx("hover"), {passive:true});
        el.addEventListener("click", ()=> playSfx("click"));
      });
    })();

    // ===== Art panel: create main + float images safely + fallback


    // ===== Confetti bursts
    let confettiOn = true;
    const toggleConfetti = document.getElementById("toggleConfetti");
    const testConfetti = document.getElementById("testConfetti");

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function confettiBurst(x,y,countBase){
      if(!confettiOn) return;

      const chaos = Number(getComputedStyle(document.documentElement).getPropertyValue("--chaos")) || 0;
      const count = Math.round(countBase + (chaos/100)*18);

      for(let i=0;i<count;i++){
        const p = document.createElement("div");
        p.className = "confetti";
        p.style.left = x + "px";
        p.style.top  = y + "px";

        const palette = [
          "rgba(255,179,107,.95)",
          "rgba(255,208,139,.95)",
          "rgba(255,138,180,.95)",
          "rgba(127,231,255,.92)",
          "rgba(255,255,255,.92)"
        ];
        p.style.background = palette[Math.floor(Math.random()*palette.length)];

        const vx = rand(-2.6, 2.6) * (1 + chaos/120);
        const vy = rand(-5.2, -2.2) * (1 + chaos/140);
        const rot = rand(-220, 220);
        const life = rand(520, 920) + chaos*2;
        const size = rand(6, 10) + chaos/30;

        p.style.width = size + "px";
        p.style.height = size + "px";
        p.style.borderRadius = rand(4, 10) + "px";
        document.body.appendChild(p);

        const start = performance.now();
        const g = 0.012 + chaos/14000;

        function tick(now){
          const t = now - start;
          const k = t / life;
          if(k >= 1){
            p.remove();
            return;
          }
          const dx = vx * t;
          const dy = vy * t + (g * t * t);
          p.style.transform = `translate(${dx}px, ${dy}px) rotate(${rot*k}deg)`;
          p.style.opacity = String(1 - k);
          requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      }
    }

    toggleConfetti.addEventListener("click", ()=>{
      confettiOn = !confettiOn;
      toggleConfetti.textContent = "Confetti: " + (confettiOn ? "ON" : "OFF");
      if(confettiOn) confettiBurst(tx, ty, 18);
    });
    testConfetti.addEventListener("click", ()=> confettiBurst(tx, ty, 22));
    toggleConfetti.textContent = "Confetti: ON";

    // Stage pop button
    document.getElementById("stagePop").addEventListener("click", ()=>{
      confettiBurst(tx, ty, 22);
      playSfx("click");
    });

    // Burst confetti on most clicks (avoid range slider)
    document.addEventListener("click", (e)=>{
      if(e.target && e.target.id === "sfxVol") return;
      const target = e.target.closest(".btn, .cta, .tag, .door, .miniBtn, .chip, .thumb, .sticker, .liveBadge, .card, .toggle, .miniPill");
      if(!target) return;
      const x = (e.clientX ?? tx);
      const y = (e.clientY ?? ty);
      confettiBurst(x, y, 10);
    }, {passive:true});

    // ===== Door behavior
    const doorBtn = document.getElementById("doorBtn");
    doorBtn.addEventListener("click", ()=>{
      playSfx("door");
      document.body.animate(
        [{filter:"brightness(1)"},{filter:"brightness(1.12)"},{filter:"brightness(1)"}],
        {duration:420, easing:"cubic-bezier(.2,.8,.2,1)"}
      );
      const about = document.getElementById("about");
      if(about) about.scrollIntoView({behavior:"smooth", block:"start"});
      confettiBurst(tx, ty, 18);
    });

    // ===== Tag filter
    const tags = document.querySelectorAll(".tag[data-filter]");
    const cards = Array.from(document.querySelectorAll(".card[data-tags]"));

    function clearActive(){ tags.forEach(t=>t.classList.remove("active")); }
    function applyFilter(filter){
      if(!filter){ cards.forEach(c=>c.style.display="block"); return; }
      cards.forEach(c=>{
        const list = (c.getAttribute("data-tags") || "").split(" ");
        c.style.display = list.includes(filter) ? "block" : "none";
      });
    }
    tags.forEach(t=>{
      t.addEventListener("click", ()=>{
        const filter = t.getAttribute("data-filter");
        const isActive = t.classList.contains("active");
        clearActive();
        if(isActive){
          applyFilter(null);
        }else{
          t.classList.add("active");
          applyFilter(filter);
          const grid = document.getElementById("content");
          if(grid) grid.scrollIntoView({behavior:"smooth", block:"start"});
        }
      });
    });

    // ===== Chaos Meter
    const chaosRange = document.getElementById("chaosRange");
    const chaosLabel = document.getElementById("chaosLabel");

    function setChaos(v){
      const n = Math.max(0, Math.min(100, Number(v)||0));
      chaosLabel.textContent = n;
      document.documentElement.style.setProperty("--chaos", n);

      const sparkle = 0.55 + (n/100)*0.45;
      document.documentElement.style.setProperty("--sparkleIntensity", sparkle.toFixed(2));

      const wiggle = (n/100)*0.6;
      document.documentElement.style.setProperty("--wiggle", wiggle.toFixed(3) + "deg");

      localStorage.setItem("hamu_chaos", String(n));
    }

    const savedChaos = localStorage.getItem("hamu_chaos");
    if(savedChaos !== null){
      chaosRange.value = savedChaos;
      setChaos(savedChaos);
    }else{
      setChaos(chaosRange.value);
    }
    chaosRange.addEventListener("input", (e)=> setChaos(e.target.value));

    // ===== Theme switch
    const themeSelect = document.getElementById("themeSelect");
    const themes = {
      sunset: {
        bg0:"#120a09", bg1:"#2a1410",
        glow1:"#ffb36b", glow2:"#ffd08b", glow3:"#ff8ab4", glow4:"#7fe7ff"
      },
      candle: {
        bg0:"#0f0a08", bg1:"#24130d",
        glow1:"#ffb86a", glow2:"#ffe3a9", glow3:"#ffb07a", glow4:"#9ff0ff"
      },
      cotton: {
        bg0:"#160b10", bg1:"#2b1217",
        glow1:"#ffc46f", glow2:"#ffe8b9", glow3:"#ff90c8", glow4:"#8fe9ff"
      }
    };

    function applyTheme(key){
      const t = themes[key] || themes.sunset;
      document.documentElement.style.setProperty("--bg0", t.bg0);
      document.documentElement.style.setProperty("--bg1", t.bg1);
      document.documentElement.style.setProperty("--glow1", t.glow1);
      document.documentElement.style.setProperty("--glow2", t.glow2);
      document.documentElement.style.setProperty("--glow3", t.glow3);
      document.documentElement.style.setProperty("--glow4", t.glow4);
      localStorage.setItem("hamu_theme", key);
    }

    const savedTheme = localStorage.getItem("hamu_theme") || "sunset";
    themeSelect.value = savedTheme;
    applyTheme(savedTheme);
    themeSelect.addEventListener("change", (e)=>{
      applyTheme(e.target.value);
      confettiBurst(tx, ty, 24);
    });

    // ===== Live badge
    const liveBadge = document.getElementById("liveBadge");
    const liveText = document.getElementById("liveText");
    const liveSub  = document.getElementById("liveSub");

    function setLive(on){
      const v = on ? "1" : "0";
      document.body.setAttribute("data-live", v);
      liveText.textContent = on ? "LIVE" : "OFFLINE";
      liveSub.textContent = on ? "mischief is happening" : "cozy warm mode";
      localStorage.setItem("hamu_live", v);
    }

    const savedLive = localStorage.getItem("hamu_live");
    setLive(savedLive === "1");

    liveBadge.addEventListener("click", ()=>{
      const on = document.body.getAttribute("data-live") === "1";
      setLive(!on);
      confettiBurst(tx, ty, !on ? 30 : 14);
    });

    // ===== Lore Flipbook
    const pages = [
      {title:"Page 1 ‚Äî Sweet Origins", text:"Born from the sweetest corners of DANGOLAND ‚Äî half rat, half hamster, 100% trouble-ready."},
      {title:"Page 2 ‚Äî The Problem With Sweet", text:"When everything is sugar and sunshine‚Ä¶ it gets boring. Hamu learned sweetness needs chaos to feel alive."},
      {title:"Page 3 ‚Äî Entertainer Lifestyle", text:"She chose the entertainer path ‚Äî Dangoland‚Äôs version of being a Jester ‚Äî to make the world react to her."},
      {title:"Page 4 ‚Äî Livestreaming Discovery", text:"Then she saw ‚ÄòLivestreaming‚Äô‚Ä¶ and knew it was destiny. Infinite audience. Infinite mischief."},
      {title:"Page 5 ‚Äî Cozy Chaos Promise", text:"Warm, comforting, playful‚Ä¶ with a prank hiding under the pillow. That‚Äôs the Hamu guarantee."}
    ];
    let pageIndex = Number(localStorage.getItem("hamu_page") || 0);
    const pageTitle = document.getElementById("pageTitle");
    const pageText  = document.getElementById("pageText");

    function renderPage(){
      const p = pages[(pageIndex + pages.length) % pages.length];
      pageTitle.textContent = p.title;
      pageText.textContent  = p.text;
      localStorage.setItem("hamu_page", String(pageIndex));
    }
    renderPage();

    document.getElementById("pagePrev").addEventListener("click", ()=>{
      pageIndex--;
      renderPage();
      playSfx("click");
    });
    document.getElementById("pageNext").addEventListener("click", ()=>{
      pageIndex++;
      renderPage();
      playSfx("click");
    });

    // ===== Hamu Mood
    const moods = [
      "Cozy‚Ä¶ but plotting something.",
      "Too sweet. Needs mischief.",
      "Jester mode: ON üé≠",
      "Suspiciously quiet‚Ä¶",
      "Probably about to cause chaos üç¨",
      "Just here for comfy vibes üíõ",
      "Sugar rush incoming.",
      "Gentle smile‚Ä¶ dangerous thoughts."
    ];
    let moodIndex = Number(localStorage.getItem("hamu_mood") || 0);
    const moodText = document.getElementById("hamuMoodText");
    const moodBtn  = document.getElementById("moodNext");

    function renderMood(){
      const m = moods[(moodIndex + moods.length) % moods.length];
      moodText.textContent = m;
      localStorage.setItem("hamu_mood", String(moodIndex));
    }
    renderMood();
    moodBtn.addEventListener("click", ()=>{
      moodIndex++;
      renderMood();
      playSfx("click");
    });

    // ===== Copy toast helper (kept safe even if no copy targets exist)
    const copyToast = document.getElementById("copyToast");
    let toastTimer = null;
    function showToast(msg){
      copyToast.textContent = msg;
      copyToast.style.display = "block";
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> copyToast.style.display = "none", 900);
    }

    document.querySelectorAll(".cmd[data-copy]").forEach(el=>{
      el.addEventListener("click", async ()=>{
        const txt = el.getAttribute("data-copy") || "";
        playSfx("hover");
        try{
          await navigator.clipboard.writeText(txt);
          showToast("Copied: " + txt);
        }catch(e){
          showToast("Copy failed (browser blocked)");
        }
      });
    });

    // ===== Sticker collection
    const stickerEls = Array.from(document.querySelectorAll(".sticker[data-id]"));
    const stampProgress = document.getElementById("stampProgress");
    const stampReset = document.getElementById("stampReset");

    function loadStamps(){
      try{ return JSON.parse(localStorage.getItem("hamu_stamps") || "{}"); }
      catch(e){ return {}; }
    }
    function saveStamps(obj){
      localStorage.setItem("hamu_stamps", JSON.stringify(obj));
    }
    function updateStamps(){
      const state = loadStamps();
      let count = 0;
      stickerEls.forEach(s=>{
        const id = s.getAttribute("data-id");
        const on = !!state[id];
        s.classList.toggle("collected", on);
        if(on) count++;
      });
      stampProgress.textContent = `Collected: ${count}/10`;
    }
    updateStamps();

    stickerEls.forEach(s=>{
      s.addEventListener("click", ()=>{
        const id = s.getAttribute("data-id");
        const state = loadStamps();
        state[id] = !state[id];
        saveStamps(state);
        updateStamps();
      });
    });

    stampReset.addEventListener("click", ()=>{
      localStorage.removeItem("hamu_stamps");
      updateStamps();
      confettiBurst(tx, ty, 28);
      playSfx("click");
    });

    // ===== Map selection highlights cards by tags
    const chips = Array.from(document.querySelectorAll(".chip[data-map]"));
    const mapHint = document.getElementById("mapHint");
    const mapToTag = { plaza: "map", stage: "stage", woods: "woods" };

    function clearChips(){ chips.forEach(c=>c.classList.remove("active")); }

    let mapActive = localStorage.getItem("hamu_map") || "";
    function applyMap(key){
      mapActive = key || "";
      localStorage.setItem("hamu_map", mapActive);

      if(!mapActive){
        clearChips();
        applyFilter(null);
        mapHint.textContent = "No location selected.";
        return;
      }

      clearChips();
      const chip = chips.find(c=>c.getAttribute("data-map") === mapActive);
      if(chip) chip.classList.add("active");

      const tag = mapToTag[mapActive];
      if(tag){
        cards.forEach(c=>{
          const list = (c.getAttribute("data-tags") || "").split(" ");
          c.style.display = list.includes(tag) ? "block" : "none";
        });
      }
      const nice = mapActive === "plaza" ? "Candy Plaza" : mapActive === "stage" ? "Jester Stage" : "Sugar Woods";
      mapHint.textContent = "Selected: " + nice;
      document.getElementById("content").scrollIntoView({behavior:"smooth", block:"start"});
    }

    chips.forEach(c=>{
      c.addEventListener("click", ()=>{
        const key = c.getAttribute("data-map");
        if(mapActive === key) applyMap("");
        else applyMap(key);
        playSfx("click");
      });
    });
    if(mapActive) applyMap(mapActive);

    // ===== Gallery lightbox
    const lightbox = document.getElementById("lightbox");
    const lbTitle  = document.getElementById("lbTitle");
    const lbImg    = document.getElementById("lbImg");
    const lbNote   = document.getElementById("lbNote");
    const lbClose  = document.getElementById("lbClose");

    function openLb({title, src, note}){
      lbTitle.textContent = title || "Gallery";
      lbNote.textContent  = note || "";
      lbImg.src = src || "";
      lbImg.alt = title || "Gallery image";
      lightbox.classList.add("open");
      lightbox.setAttribute("aria-hidden","false");
      confettiBurst(tx, ty, 10);
      playSfx("click");
    }
    function closeLb(){
      lightbox.classList.remove("open");
      lightbox.setAttribute("aria-hidden","true");
      lbImg.src = "";
    }
    lbClose.addEventListener("click", closeLb);
    lightbox.addEventListener("click", (e)=>{ if(e.target === lightbox) closeLb(); });
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeLb(); });

    document.querySelectorAll(".thumb").forEach(t=>{
      t.addEventListener("click", ()=>{
        openLb({
          title: t.getAttribute("data-title"),
          src:   t.getAttribute("data-src"),
          note:  t.getAttribute("data-note")
        });
      });
    });

    // ===== Mascot helper tips + toggle
    const mascot = document.getElementById("mascot");
    const mascotBtn = document.getElementById("mascotBtn");
    const bubble = document.getElementById("mascotBubble");
    const helperToggle = document.getElementById("helperToggle");
    const helperNext = document.getElementById("helperNext");

    const tips = [
      "Click a <b>tag</b> to filter sections. Click the same tag again to reset.",
      "Use the <b>Chaos Meter</b> to crank up sparkles + wiggle + confetti.",
      "Try the <b>Dangoland Map</b> ‚Äî it highlights cards by location vibe.",
      "Collect all <b>10 stamps</b> ‚Äî it saves in your browser like a tiny achievement."
    ];
    let tipIndex = Number(localStorage.getItem("hamu_tip") || 0);
    let helperOn = (localStorage.getItem("hamu_helper") ?? "1") === "1";

    function showTip(index){
      tipIndex = (index + tips.length) % tips.length;
      localStorage.setItem("hamu_tip", String(tipIndex));
      bubble.innerHTML = tips[tipIndex];
      if(helperOn){
        mascot.classList.add("show");
        clearTimeout(window.__tipTimer);
        window.__tipTimer = setTimeout(()=> mascot.classList.remove("show"), 4200);
      }
    }
    function setHelper(on){
      helperOn = !!on;
      localStorage.setItem("hamu_helper", helperOn ? "1" : "0");
      helperToggle.textContent = "Helper: " + (helperOn ? "ON" : "OFF");
      if(!helperOn) mascot.classList.remove("show");
      else showTip(tipIndex);
    }

    helperToggle.addEventListener("click", ()=>{ setHelper(!helperOn); playSfx("click"); });
    helperNext.addEventListener("click", ()=>{ showTip(tipIndex + 1); playSfx("click"); });

    mascotBtn.addEventListener("click", ()=>{
      if(!helperOn){ setHelper(true); playSfx("click"); return; }
      showTip(tipIndex + 1);
      playSfx("click");
    });

    setHelper(helperOn);
    if(helperOn) setTimeout(()=> showTip(tipIndex), 650);

    // ==========================
    // üç° Smooth Mouse Trail
    // ==========================
    (function(){
      const wrap = document.getElementById("hamuTrail");
      if(!wrap) return;

      const reduced = window.matchMedia &&
        window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if(reduced) return;

      const DOTS = 18;
      const ease = 0.22;
      const dots = [];
      const pos = [];

      let mx = window.innerWidth/2;
      let my = window.innerHeight/2;

      const colors = [
        "rgba(255,138,180,.95)", // pink
        "rgba(255,208,139,.95)", // yellow
        "rgba(130,255,190,.95)"  // green
      ];

      for(let i=0;i<DOTS;i++){
        const d = document.createElement("div");
        d.className = "hamuTrailDot";

        const s = 12 - i*0.35;
        d.style.width = s + "px";
        d.style.height = s + "px";
        d.style.opacity = String(0.9 - i*(0.9/(DOTS+2)));

        const color = colors[i % colors.length];
        d.style.background = `radial-gradient(circle at 30% 30%, white 0%, ${color} 45%, transparent 75%)`;
        d.style.boxShadow = `0 0 14px ${color}, 0 0 28px ${color}`;

        wrap.appendChild(d);
        dots.push(d);
        pos.push({x: mx, y: my});
      }

      window.addEventListener("mousemove", (e)=>{
        mx = e.clientX;
        my = e.clientY;
      }, {passive:true});

      function tick(){
        const chaos = Number(getComputedStyle(document.documentElement)
          .getPropertyValue("--chaos")) || 0;

        const k = ease + (chaos/100)*0.06;

        pos[0].x += (mx - pos[0].x) * k;
        pos[0].y += (my - pos[0].y) * k;

        for(let i=1;i<DOTS;i++){
          pos[i].x += (pos[i-1].x - pos[i].x) * k;
          pos[i].y += (pos[i-1].y - pos[i].y) * k;
        }

        for(let i=0;i<DOTS;i++){
          dots[i].style.transform =
            `translate(${pos[i].x}px, ${pos[i].y}px) translate(-50%,-50%)`;
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    })();

    // ===== Show All Button (clears ALL filters safely)
    const showAllBtn = document.getElementById("showAllBtn");
    if(showAllBtn){
      showAllBtn.addEventListener("click", ()=>{
        try{ localStorage.removeItem("hamu_map"); }catch(e){}

        document.querySelectorAll(".tag.active").forEach(t=> t.classList.remove("active"));
        document.querySelectorAll(".chip.active").forEach(c=> c.classList.remove("active"));
        document.querySelectorAll(".card[data-tags]").forEach(c=> c.style.display = "block");

        const hint = document.getElementById("mapHint");
        if(hint) hint.textContent = "No location selected.";

        const content = document.getElementById("content");
        if(content) content.scrollIntoView({behavior:"smooth", block:"start"});

        playSfx("click");
        confettiBurst(tx, ty, 18);
      });
    }
    // ==========================
// ‚ú® Extra Background Particles (Canvas)
// ==========================
(function(){
  const c = document.getElementById("particleCanvas");
  if(!c) return;

  const reduced = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduced) return;

  const ctx = c.getContext("2d", { alpha:true });

  let w = 0, h = 0, dpr = Math.min(2, window.devicePixelRatio || 1);

  function resize(){
    w = Math.floor(window.innerWidth);
    h = Math.floor(window.innerHeight);
    dpr = Math.min(2, window.devicePixelRatio || 1);
    c.width = Math.floor(w * dpr);
    c.height = Math.floor(h * dpr);
    c.style.width = w + "px";
    c.style.height = h + "px";
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  resize();
  window.addEventListener("resize", resize, { passive:true });

  // Pull theme colors from CSS vars (updates when you switch themes)
  function readColors(){
    const s = getComputedStyle(document.documentElement);
    const g1 = s.getPropertyValue("--glow1").trim() || "#ffb36b";
    const g2 = s.getPropertyValue("--glow2").trim() || "#ffd08b";
    const g3 = s.getPropertyValue("--glow3").trim() || "#ff8ab4";
    const g4 = s.getPropertyValue("--glow4").trim() || "#7fe7ff";
    return [g1,g2,g3,g4,"rgba(255,255,255,.9)"];
  }

  // Particle count scales with screen size + chaos
  function targetCount(){
    const chaos = Number(getComputedStyle(document.documentElement).getPropertyValue("--chaos")) || 35;
    const base = Math.round((w * h) / 18000); // density
    return Math.max(45, Math.min(180, base + Math.round(chaos * 0.5)));
  }

  const parts = [];
  let colors = readColors();

  function rand(min,max){ return Math.random()*(max-min)+min; }

  function makeParticle(){
    const big = Math.random() < 0.12; // 12% slightly bigger sparkles
    const r = big ? rand(1.8, 3.8) : rand(0.6, 1.6);
    return {
      x: rand(0, w),
      y: rand(0, h),
      vx: rand(-0.06, 0.06),
      vy: rand(0.03, 0.14),
      r,
      a: big ? rand(0.35, 0.75) : rand(0.15, 0.45),
      tw: rand(0.002, 0.008), // twinkle speed
      t: rand(0, 999),
      col: colors[Math.floor(Math.random()*colors.length)]
    };
  }

  function syncCount(){
    colors = readColors();
    const want = targetCount();
    while(parts.length < want) parts.push(makeParticle());
    while(parts.length > want) parts.pop();
  }
  syncCount();

  // re-sync on theme changes (your theme switch updates CSS vars)
  const themeSelect = document.getElementById("themeSelect");
  if(themeSelect){
    themeSelect.addEventListener("change", ()=> setTimeout(syncCount, 0));
  }

  let last = performance.now();

  function tick(now){
    const dt = Math.min(40, now - last);
    last = now;

    // if chaos changes, gently adjust count occasionally
    if(Math.random() < 0.02) syncCount();

    ctx.clearRect(0,0,w,h);

    // soft vignette glow (subtle extra warmth)
    const vg = ctx.createRadialGradient(w*0.5, h*0.6, 10, w*0.5, h*0.6, Math.max(w,h)*0.8);
    vg.addColorStop(0, "rgba(255,255,255,.04)");
    vg.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = vg;
    ctx.fillRect(0,0,w,h);

    for(const p of parts){
      p.t += dt * p.tw;
      const twinkle = 0.65 + Math.sin(p.t) * 0.35;

      p.x += p.vx * dt;
      p.y += p.vy * dt;

      // wrap
      if(p.y > h + 10) { p.y = -10; p.x = rand(0,w); }
      if(p.x < -10) p.x = w + 10;
      if(p.x > w + 10) p.x = -10;

      // glow dot
      const rr = p.r * (0.85 + twinkle*0.6);
      ctx.globalAlpha = p.a * twinkle;

      const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, rr*4.2);
      g.addColorStop(0, p.col);
      g.addColorStop(0.5, "rgba(255,255,255,.14)");
      g.addColorStop(1, "rgba(255,255,255,0)");
      ctx.fillStyle = g;

      ctx.beginPath();
      ctx.arc(p.x, p.y, rr*3.4, 0, Math.PI*2);
      ctx.fill();
    }

    ctx.globalAlpha = 1;
    requestAnimationFrame(tick);
  }

  requestAnimationFrame(tick);
})();
  </script>
</body>
</html>